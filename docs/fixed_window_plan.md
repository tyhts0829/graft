# fixed_window_plan.md

どこで: `src/app/draw_window.py`, `src/api/run.py`, 付随する設定箇所。
何を: ウィンドウリサイズを禁止し、canvas_size に基づく固定アスペクトのまま描画するようにする。これに伴いリサイズハンドラの不要部分を整理する。
なぜ: 想定する「紙サイズ＝canvas_size」を保ち、リサイズでアスペクトが崩れて描画が歪む問題を解消するため。リサイズ機能をそもそも提供しないことで実装も単純化できる。

## 0. ゴール
- ウィンドウを固定サイズ（canvas_size × render_scale）で生成し、ユーザーがリサイズできないようにする。
- リサイズハンドラを削除または無効化し、射影行列は初期化時の一度だけ設定する現行方針と整合させる。
- main.py のようなスケッチでウィンドウをドラッグしてもアスペクトが変わらず歪まないことを確認する。

## 1. 方針
- `draw_window.create_draw_window` で `resizable=False` を指定し、固定サイズで作成。
- `api/run.py` の `on_resize` ハンドラを削除し、`window.push_handlers` からも外す。
- `DrawRenderer.viewport` 呼び出しは初期化時に一度だけで十分になるが、既存の呼び出し箇所を整理してシンプルにする。
- ドキュメント（README や plan）に「ウィンドウは固定サイズで、canvas_size が基準」と明記する（必要なら）。

## 2. タスク分解（チェックリスト）
- [x] `src/app/draw_window.py`: `Window(..., resizable=False)` とし、初期作成時に viewport を設定するヘルパを追加。
- [x] `src/api/run.py`: `on_resize` ハンドラと登録を削除し、viewport 設定を初期化側に一度だけ行うよう整理。
- [ ] `src/render/draw_renderer.py`: viewport 設定が初期化時または run 入口で一度だけ行われることを確認し、不要な呼び出しがあれば削除。
- [ ] テスト/動作確認: main.py を手動で起動し、ウィンドウドラッグでサイズが変わらないこと、歪みが解消されていることを確認（自動テストは対象外）。
- [ ] ドキュメント更新（任意）: README か plan に「ウィンドウサイズ固定・canvas 基準」を追記。

## 3. リスク・留意点
- ユーザーがウィンドウサイズ変更を望むケースでは機能がなくなる。必要なら将来オプションフラグで再導入可能。
- Retina / DPI スケール環境での見え方を確認（render_scale はそのまま機能する）。
- ビューポート設定の位置を間違えると初期描画がクリップされる可能性があるため、初期化後すぐに viewport を設定しておく。

## 4. 完了定義
- ウィンドウがリサイズ不可となり、`on_resize` 関連コードが除去されている。
- 固定アスペクトで描画が歪まないことを手動確認。
- 既存テストがすべてグリーンのまま。
