# fill のハッチが「閉曲線内で回る」回転バグ: 修正計画

## 背景 / 現象

- `main.py` で polyhedron を回転させると、`fill` のハッチ線が境界の中で「ぐるぐる回る」。
- 旧実装では同じ挙動が発生しなかった。

## 想定原因（実装起因）

- `transform_to_xy_plane` が「法線を Z に揃える」だけで、面内の回転（法線まわりの自由度）を固定していない。
- その結果、物体が「面の法線まわり」に回転したとき、2D 空間上では輪郭が回転する一方でハッチ生成は固定角（XY基準）なので、境界内でハッチが回って見える。

## 方針（旧実装に寄せる）

- 3D→XY 整列時に、法線揃えに加えて「面内の回転」も固定する。
  - XY に落とした後、最初に見つかった非ゼロの辺方向を +X へ揃える Z 回転を追加する。
  - これにより、物体が法線まわりに回転しても 2D 上では輪郭の向きが一定になり、ハッチが境界に追従する。

## チェックリスト

- [x] `src/effects/util.py` の `transform_to_xy_plane` に面内回転固定（辺→+X）を追加
- [x] `transform_back` の逆変換が保たれていることを確認
- [x] `tests/test_fill.py` に「Z 回転でハッチが形状に追従する」回帰テストを追加
- [ ] `main.py` で目視確認（ユーザー側で実施）
